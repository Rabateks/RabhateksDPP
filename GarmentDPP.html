<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Rabateks DPP ‚Äì Garment Manufacturing</title>
<!-- Local font fallback to avoid CORS issues -->
<style>
:root{
  --primary:#02154e;
  --accent:#f9ba00;
  --green:#005530;
  --red:#D51635;
  --navy:#02154e;
  --orange:#f9ba00;
  --bg:#f6f7f9;
  --card:#ffffff;
  --muted:#8a94a6;
  --border:#e6e8ee;
}
*{box-sizing:border-box}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:#1b2430}

/* Header */
.app-header{
  display:flex; align-items:center; justify-content:space-between; gap:12px;
  padding:14px 18px; border-bottom:1px solid var(--border); background:#fff;
  position:sticky; top:0; z-index:40;
}
.header-left{display:flex; align-items:center; gap:12px}
.brand-logo{display:inline-block;width:48px;height:48px;border-radius:50%;border:3px solid #fff;box-shadow:0 2px 8px rgba(0,85,48,0.3);overflow:hidden}
.brand-logo img{width:100%;height:100%;object-fit:cover;display:block}
.title{font-size:18px;font-weight:700;}
.subtitle{font-size:12px;color:var(--muted)}

/* Back link button */
.back-link{
  display:inline-flex; align-items:center; gap:8px; height:40px; padding:0 14px;
  border-radius:10px; background:var(--green); color:#fff; font-weight:600; text-decoration:none;
  border:1px solid transparent; box-shadow:0 2px 8px rgba(0,85,48,0.25);
  transition:transform .15s, box-shadow .15s, background .15s;
}
.back-link:hover{ transform:translateY(-1px); box-shadow:0 4px 12px rgba(0,85,48,0.35); }
.back-link:active{ transform:translateY(0); }

/* Import notification */
.import-notification{
  background:linear-gradient(135deg, #4CAF50, #81C784);
  color:white; padding:12px 18px; text-align:center; font-weight:600;
  border-bottom:1px solid rgba(76,175,80,0.3); box-shadow:0 2px 8px rgba(76,175,80,0.25);
  display:none;
}
.import-notification.show{ display:block; animation:slideDown 0.5s ease; }
@keyframes slideDown{ from{transform:translateY(-100%)} to{transform:translateY(0)} }

/* Layout */
.container{max-width:1200px;margin:18px auto;padding:0 18px}
.form-wrap{background:var(--card);border:2px solid var(--border);border-radius:14px;box-shadow:0 2px 10px rgba(2,21,78,0.05);position:relative}
.form-wrap.editing{border-color:var(--green);}
.editing-label{position:absolute;top:-12px;left:14px;background:var(--green);color:#fff;padding:2px 8px;font-size:12px;border-radius:6px;display:none;}
.form-wrap.editing .editing-label{display:inline-block;}
.form-row{display:flex;flex-wrap:wrap;gap:12px;align-items:flex-end;overflow-x:auto;padding:14px;scrollbar-width:thin}
.field{flex:1 1 200px;display:flex;flex-direction:column;gap:6px;min-width:160px}
.field label{font-size:12px;color:var(--muted)}
.field input,.field select{height:40px;border:1px solid var(--border);border-radius:10px;padding:0 10px;background:#fff;font-size:14px}
.field select[multiple]{height:auto;min-height:40px;padding:6px}
input[readonly]{background:#f7f9fb;color:#4b5563;border-style:dashed}
.helper{font-size:11px;color:var(--muted);margin-top:-2px}
.actions{display:flex;gap:10px;padding:0 14px 14px;flex-wrap:wrap}
.btn{height:40px;padding:0 14px;border:1px solid transparent;border-radius:10px;background:var(--green);color:#fff;font-weight:600;cursor:pointer;transition:all 0.2s}
.btn:hover{transform:translateY(-1px);box-shadow:0 4px 12px rgba(0,85,48,0.3)}
.btn.secondary{background:#fff;color:var(--primary);border-color:var(--border)}
.btn.secondary:hover{background:var(--bg);border-color:var(--primary)}
.btn.danger{background:var(--red);color:#fff}
.btn.danger:hover{background:#b01429;box-shadow:0 4px 12px rgba(213,22,53,0.3)}

/* Dashboard cards */
.dashboard{display:grid;grid-template-columns:repeat(5,1fr);gap:12px;margin-top:16px}
.card{background:linear-gradient(135deg, #fff, #fafbfc);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 2px 8px rgba(0,0,0,0.05);transition:transform 0.2s}
.card:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,0.1)}
.metric-title{font-size:12px;color:var(--muted)}
.metric-value{font-size:24px;font-weight:700;margin-top:8px;background:linear-gradient(135deg, var(--green), var(--orange));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}

/* List / Scorecards */
.list{margin-top:16px;display:grid;gap:12px}
.scorecard{border:1px solid var(--border);border-radius:14px;background:#fff;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.08);transition:transform 0.2s, box-shadow 0.2s}
.scorecard:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,0.12)}
.scorecard-header{background:linear-gradient(135deg, var(--orange), #ffca28);color:#1a1a1a;display:flex;justify-content:space-between;align-items:center;padding:12px 16px;font-weight:700;box-shadow:0 2px 4px rgba(0,0,0,0.1);border-radius:14px 14px 0 0}
.scorecard-body{padding:12px 14px;border-top:1px solid var(--border)}
.grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.kv{background:#fafafa;border:1px solid var(--border);border-radius:10px;padding:10px}
.kv .k{font-size:11px;color:var(--muted)}
.kv .v{font-size:14px;font-weight:600;margin-top:4px}
.row-actions{display:flex;gap:8px}
.icon-btn{height:34px;padding:0 10px;border-radius:8px;border:1px solid var(--border);background:#fff;cursor:pointer;transition:all 0.2s;font-size:12px}
.icon-btn:hover{background:var(--bg);border-color:var(--green)}
.icon-btn.edit:hover{background:rgba(0,85,48,0.1);color:var(--green)}
.icon-btn.delete:hover{background:rgba(213,22,53,0.1);color:var(--red);border-color:var(--red)}

/* Multi-Select Dropdown */
.multi-select-container { position: relative; width: 100%; }
.multi-select-display { min-height: 40px; border: 1px solid var(--border); border-radius: 10px; padding: 6px 10px; background: #fff; cursor: pointer; display: flex; flex-wrap: wrap; gap: 4px; align-items: center; font-size: 14px; }
.multi-select-display:focus { outline: 2px solid var(--green); outline-offset: 1px; }
.selected-tag { background: linear-gradient(135deg, var(--green), #007d4a); color: white; padding: 3px 10px; border-radius: 12px; font-size: 12px; display: flex; align-items: center; gap: 6px; white-space: nowrap; box-shadow: 0 2px 4px rgba(0,85,48,0.2); font-weight: 500; }
.remove-tag { cursor: pointer; font-weight: bold; font-size: 14px; line-height: 1; padding: 0 2px; border-radius: 50%; transition: background-color 0.2s; }
.remove-tag:hover { background: rgba(255,255,255,0.2); }
.placeholder { color: var(--muted); font-size: 14px; flex: 1; }
.dropdown-arrow { margin-left: auto; transition: transform 0.2s; font-size: 12px; color: var(--muted); }
.multi-select-dropdown { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid var(--border); border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; max-height: 200px; overflow-y: auto; display: none; margin-top: 2px; }
.multi-select-dropdown.open { display: block; }
.dropdown-option { padding: 10px 12px; cursor: pointer; border-bottom: 1px solid var(--border); display: flex; align-items: center; gap: 8px; transition: background-color 0.2s; }
.dropdown-option:last-child { border-bottom: none; }
.dropdown-option:hover { background: var(--bg); }
.dropdown-option.selected { background: rgba(0, 85, 48, 0.1); font-weight: 500; }
.checkbox { width: 16px; height: 16px; border: 2px solid var(--border); border-radius: 3px; display: flex; align-items: center; justify-content: center; font-size: 10px; color: white; transition: all 0.2s; }
.checkbox.checked { background: var(--green); border-color: var(--green); }

/* Responsive */
@media (max-width:1200px){.dashboard{grid-template-columns:repeat(3,1fr)}}
@media (max-width:1000px){.dashboard{grid-template-columns:repeat(2,1fr)}.grid{grid-template-columns:repeat(2,1fr)}}
@media (max-width:560px){.dashboard{grid-template-columns:1fr}.grid{grid-template-columns:1fr}}
</style>
</head>
<body>

<header class="app-header">
  <div class="header-left">
    <span class="brand-logo"><img src="assets/img/logo.png" alt="Rabateks Logo"></span>
    <div>
      <div class="title">
        <span style="color:#005530;">Rabateks</span>
        <span style="color:#f9ba00;">DPP</span>
        <span style="color:#000;font-weight:400;"> ‚Äì Garment Manufacturing</span>
      </div>
      <div class="subtitle">Digital Product Passport ¬∑ Production Tracking ¬∑ Quality Control</div>
    </div>
  </div>
  <a class="back-link" href="index.html" title="Back to Main Dashboard">‚Üê Back to Main Dashboard</a>
</header>

<!-- Import Notification -->
<div class="import-notification" id="importNotification">
  üî• <span id="importMessage">Imported orders from Random Order Creator</span>
</div>

<main class="container">
  <section class="form-wrap" id="formWrap">
    <div class="editing-label">Editing Record</div>
    <div class="form-row">
      <div class="field">
        <label>Country</label>
        <select id="country">
          <option value="T√ºrkiye">T√ºrkiye</option><option>Germany</option><option>Netherlands</option>
          <option>Spain</option><option>United Kingdom</option><option>Italy</option><option>Portugal</option>
        </select>
      </div>

      <div class="field">
        <label>Production Facility</label>
        <select id="productionFacility">
          <option>Rabateks Main Factory</option><option>Rabateks Facility 2</option><option>Partner Factory A</option>
          <option>Partner Factory B</option><option>External Contractor 1</option><option>External Contractor 2</option>
        </select>
      </div>

      <div class="field"><label>PO No.</label><input id="po" type="text" placeholder="e.g., PO-24567"></div>
      <div class="field"><label>Style Name</label><input id="style" type="text" placeholder="e.g., AURORA-TSH"></div>

      <div class="field">
        <label>Product Type</label>
        <select id="productType">
          <!-- WOVEN -->
          <optgroup label="Woven">
            <option>Dress shirt</option>
            <option>Casual shirt</option>
            <option>Flannel shirt</option>
            <option>Suit jacket</option>
            <option>Trousers</option>
            <option>Waistcoat</option>
            <option>Blazer</option>
            <option>Trench coat</option>
            <option>Bomber jacket</option>
            <option>Safari jacket</option>
            <option>Chinos</option>
            <option>Dress pants</option>
            <option>Cargo pants</option>
            <option>Pencil skirt</option>
            <option>Pleated skirt</option>
            <option>A-line skirt</option>
            <option>Shift dress</option>
            <option>Shirt dress</option>
            <option>Wrap dress</option>
            <option>Blouse</option>
            <option>Tunic</option>
            <option>Peasant top</option>
            <option>Tailored shorts</option>
            <option>Bermuda shorts</option>
            <option>Overcoat</option>
            <option>Pea coat</option>
            <option>Duffle coat</option>
            <option>Fedora hat</option>
            <option>Bucket hat</option>
            <option>Tote bag</option>
            <option>Clutch bag</option>
            <option>Uniform shirt</option>
            <option>Work trousers</option>
          </optgroup>

          <!-- CIRCULAR KNIT -->
          <optgroup label="Circular Knit">
            <option>Crew neck T-shirt</option>
            <option>V-neck T-shirt</option>
            <option>Polo shirt</option>
            <option>Crewneck sweatshirt</option>
            <option>Hoodie</option>
            <option>Quarter-zip sweatshirt</option>
            <option>Jogger pants</option>
            <option>Sweatpants</option>
            <option>Tank top</option>
            <option>Lightweight sweater</option>
            <option>Thermal underwear</option>
            <option>Long johns</option>
            <option>Knit pyjamas</option>
            <option>Jersey sports top</option>
            <option>Yoga top</option>
            <option>Knit dress</option>
            <option>Bodycon dress</option>
            <option>Jersey shorts</option>
            <option>Jersey skirt</option>
          </optgroup>

          <!-- FLAT KNIT -->
          <optgroup label="Flat Knit">
            <option>Crew neck sweater</option>
            <option>V-neck sweater</option>
            <option>Turtleneck sweater</option>
            <option>Button-up cardigan</option>
            <option>Open-front cardigan</option>
            <option>Poncho</option>
            <option>Vest</option>
            <option>Sleeveless pullover</option>
            <option>Knitted shawl</option>
            <option>Knitted scarf</option>
            <option>Knitted beanie</option>
            <option>Knitted cap</option>
            <option>Knitted gloves</option>
            <option>Knitted dress</option>
            <option>Knitted baby romper</option>
            <option>Knitted waistcoat</option>
          </optgroup>

          <!-- NON-WOVEN -->
          <optgroup label="Non-Woven">
            <option>Medical gown</option>
            <option>Surgical mask</option>
            <option>Surgical cap</option>
            <option>Disposable coverall</option>
            <option>Disposable tablecloth</option>
            <option>Non-woven shopper bag</option>
            <option>Sanitary pad top layer</option>
            <option>Baby diaper top layer</option>
            <option>Cleaning cloth</option>
            <option>Non-woven filter</option>
            <option>Non-woven glove lining</option>
            <option>Disposable hotel slippers</option>
            <option>Gift wrap</option>
            <option>Garment bag</option>
          </optgroup>

          <!-- DENIM -->
          <optgroup label="Denim">
            <option>Slim jeans</option>
            <option>Straight jeans</option>
            <option>Bootcut jeans</option>
            <option>Flare jeans</option>
            <option>Boyfriend jeans</option>
            <option>Skinny jeans</option>
            <option>Trucker denim jacket</option>
            <option>Oversized denim jacket</option>
            <option>Western denim shirt</option>
            <option>Mini denim skirt</option>
            <option>Midi denim skirt</option>
            <option>Maxi denim skirt</option>
            <option>Denim overall</option>
            <option>Denim pinafore dress</option>
            <option>Cut-off denim shorts</option>
            <option>Bermuda denim shorts</option>
            <option>Denim tote bag</option>
            <option>Denim backpack</option>
            <option>Denim bucket hat</option>
            <option>Denim cap</option>
            <option>Denim work overalls</option>
            <option>Denim vest</option>
          </optgroup>
        </select>
      </div>

      <div class="field">
        <label>Fabric Type</label>
        <select id="fabricType">
          <option>Woven</option><option>Denim</option><option>Circular Knit</option>
          <option>Flatknit</option><option>Nonwoven</option>
        </select>
      </div>

      <div class="field">
        <label>Fabric Name</label>
        <input id="fabricName" type="text" placeholder="e.g., Single Jersey / Twill / Denim" />
        <div class="helper">Required</div>
      </div>

      <div class="field">
        <label>Fabric Code</label>
        <div class="input-row">
          <input id="fabricCode" type="text" placeholder="e.g., SJ-180-KN / DN-420-WV" />
          <button type="button" class="btn secondary" id="genCodeBtn" title="Generate from Type + Name + GSM">Generate</button>
        </div>
        <div class="helper">Required ¬∑ Pattern: <code>AAA-123(-XXXX)</code></div>
      </div>

      <div class="field">
        <label>Fabric Construction</label>
        <select id="fabricConstruction">
          <!-- KNIT -->
          <optgroup label="Knit">
            <option>Single Jersey</option><option>Double Jersey</option><option>Interlock</option>
            <option>Rib 1x1</option><option>Rib 2x2</option><option>Ottoman</option><option>Waffle Knit</option>
            <option>French Terry</option><option>Terry</option><option>Fleece Knit</option><option>Pique Knit</option>
            <option>Jacquard Knit</option><option>Mesh Knit</option><option>Ponte Roma</option><option>Milano Rib</option>
          </optgroup>
          <!-- WOVEN -->
          <optgroup label="Woven">
            <option>Plain Weave / Poplin</option><option>Oxford</option><option>Chandray</option><option>Canvas</option>
            <option>Twill</option><option>Denim</option><option>Satin</option><option>Sateen</option>
            <option>Herringbone</option><option>Dobby</option><option>Seersucker</option><option>Jacquard Woven</option>
            <option>Corduroy</option><option>Ripstop</option>
          </optgroup>
          <!-- OTHER -->
          <optgroup label="Other">
            <option>Lace</option><option>Velvet</option><option>Velour</option><option>Softshell (Knit Bonded)</option>
            <option>Bonded / Laminated</option><option>Nonwoven Spunbond</option><option>Nonwoven Meltblown</option>
          </optgroup>
        </select>
      </div>

      <div class="field"><label>Fabric Weight (gsm)</label><input id="fabricWeight" type="number" min="0" step="1" placeholder="e.g., 180"></div>
      <div class="field"><label>Quantity</label><input id="qty" type="number" min="0" step="1" placeholder="e.g., 1200"></div>

      <div class="field">
        <label>Production Step (multi)</label>
        <div class="multi-select-container" id="stepsMultiSelect">
          <div class="multi-select-display" tabindex="0">
            <span class="placeholder">Select production steps...</span>
            <span class="dropdown-arrow">‚ñº</span>
          </div>
          <div class="multi-select-dropdown">
            <div class="ms-actions">
              <div class="ms-search"><input type="text" placeholder="Search steps..."></div>
              <button type="button" class="small-btn ms-select-all">Select All</button>
              <button type="button" class="small-btn ms-clear-all">Clear</button>
            </div>
            <div class="dropdown-option" data-value="Cutting"><div class="checkbox"></div><span>Cutting</span></div>
            <div class="dropdown-option" data-value="Bundling"><div class="checkbox"></div><span>Bundling</span></div>
            <div class="dropdown-option" data-value="Sewing"><div class="checkbox"></div><span>Sewing</span></div>
            <div class="dropdown-option" data-value="Embroidery"><div class="checkbox"></div><span>Embroidery</span></div>
            <div class="dropdown-option" data-value="Printing"><div class="checkbox"></div><span>Printing</span></div>
            <div class="dropdown-option" data-value="Washing"><div class="checkbox"></div><span>Washing</span></div>
            <div class="dropdown-option" data-value="Drying"><div class="checkbox"></div><span>Drying</span></div>
            <div class="dropdown-option" data-value="Finishing"><div class="checkbox"></div><span>Finishing</span></div>
            <div class="dropdown-option" data-value="Trimming"><div class="checkbox"></div><span>Trimming</span></div>
            <div class="dropdown-option" data-value="Ironing/Pressing"><div class="checkbox"></div><span>Ironing/Pressing</span></div>
            <div class="dropdown-option" data-value="Quality Control"><div class="checkbox"></div><span>Quality Control</span></div>
            <div class="dropdown-option" data-value="Packing"><div class="checkbox"></div><span>Packing</span></div>
            <div class="dropdown-option" data-value="Dispatch"><div class="checkbox"></div><span>Dispatch</span></div>
          </div>
        </div>
        <div class="helper">Tƒ±klayarak istediƒüiniz production step'leri se√ßin.</div>
      </div>

      <!-- NEW: Auto CO2 field -->
      <div class="field">
        <label>CO‚ÇÇ Emission (kg) ‚Äì Auto</label>
        <input id="co2" type="number" placeholder="0.00" readonly>
        <div class="helper" id="co2Helper">Estimated from GSM √ó product area √ó emission factor.</div>
      </div>
    </div>

    <div class="actions">
      <button type="button" class="btn" id="addBtn">‚ûï Add Record</button>
      <button type="button" class="btn secondary" id="clearBtn">üóëÔ∏è Clear</button>
      <button type="button" class="btn" id="saveChangesBtn" style="display:none;">üíæ Save Changes</button>
      <button type="button" class="btn danger" id="cancelEditBtn" style="display:none;">‚ùå Cancel</button>
      <button type="button" class="btn secondary" id="exportCsvBtn">‚¨áÔ∏è Export CSV</button>
      <button type="button" class="btn secondary" id="importCsvBtn">‚¨ÜÔ∏è Import CSV</button>
      <button type="button" class="btn secondary" id="templateCsvBtn">üìÑ Download CSV Template</button>
      <button type="button" class="btn secondary" id="importOrdersBtn">üì• Import Orders</button>
      <button type="button" class="btn secondary" id="debugImportBtn">üîç Debug Import</button>
    </div>
  </section>

  <section class="dashboard">
    <div class="card">
      <div class="metric-title">üìã Total POs</div>
      <div class="metric-value" id="mPos">0</div>
    </div>
    <div class="card">
      <div class="metric-title">üì¶ Total Quantity</div>
      <div class="metric-value" id="mQty">0</div>
    </div>
    <div class="card">
      <div class="metric-title">‚öñÔ∏è Avg Fabric Weight (gsm)</div>
      <div class="metric-value" id="mAvgGsm">0</div>
    </div>
    <div class="card">
      <div class="metric-title">üé® Unique Styles</div>
      <div class="metric-value" id="mStyles">0</div>
    </div>
    <div class="card">
      <div class="metric-title">üå± Total CO‚ÇÇ (kg)</div>
      <div class="metric-value" id="mCO2">0</div>
    </div>
  </section>

  <section class="list" id="scorecards"></section>
</main>

<script>
// Multi-Select Component
class MultiSelect {
  constructor(container, options = {}) {
    this.container = container;
    this.display = container.querySelector('.multi-select-display');
    this.dropdown = container.querySelector('.multi-select-dropdown');
    this.options = container.querySelectorAll('.dropdown-option');
    this.searchInput = container.querySelector('.ms-search input');
    this.selectAllBtn = container.querySelector('.ms-select-all');
    this.clearAllBtn = container.querySelector('.ms-clear-all');
    this.selectedValues = new Set();
    this.placeholder = options.placeholder || 'Select options...';
    this.onChangeCallback = options.onChange || (() => {});
    this.init();
  }
  init() {
    this.display.addEventListener('click', (e) => {
      if (e.target.classList.contains('remove-tag')) return;
      this.toggleDropdown();
    });
    this.options.forEach(option => {
      option.addEventListener('click', (e) => {
        e.stopPropagation();
        this.toggleOption(option.dataset.value);
      });
    });
    document.addEventListener('click', (e) => {
      if (!this.container.contains(e.target)) this.closeDropdown();
    });
    if(this.searchInput){ this.searchInput.addEventListener('input', ()=>{ this.filterOptions(this.searchInput.value); }); }
    if(this.selectAllBtn){ this.selectAllBtn.addEventListener('click', ()=>{ this.selectVisible(); }); }
    if(this.clearAllBtn){ this.clearAllBtn.addEventListener('click', ()=>{ this.clear(); this.onChangeCallback(this.getValues()); }); }
    this.display.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); this.toggleDropdown(); }
    });
    this.updateDisplay();
  }
  toggleDropdown() {
    this.dropdown.classList.contains('open') ? this.closeDropdown() : this.openDropdown();
  }
  openDropdown() { this.dropdown.classList.add('open'); this.display.querySelector('.dropdown-arrow').style.transform = 'rotate(180deg)'; }
  closeDropdown() { this.dropdown.classList.remove('open'); this.display.querySelector('.dropdown-arrow').style.transform = 'rotate(0deg)'; }
  toggleOption(value) {
    if (this.selectedValues.has(value)) this.selectedValues.delete(value);
    else this.selectedValues.add(value);
    this.updateDisplay(); this.updateOptions(); this.onChangeCallback(this.getValues());
  }
  updateDisplay() {
    const placeholder = this.display.querySelector('.placeholder');
    const arrow = this.display.querySelector('.dropdown-arrow');
    this.display.querySelectorAll('.selected-tag').forEach(tag => tag.remove());
    if (this.selectedValues.size === 0) {
      placeholder.style.display = 'block';
    } else {
      placeholder.style.display = 'none';
      this.selectedValues.forEach(value => {
        const tag = document.createElement('div');
        tag.className = 'selected-tag';
        tag.innerHTML = `<span>${value}</span><span class="remove-tag" data-value="${value}">√ó</span>`;
        tag.querySelector('.remove-tag').addEventListener('click', (e) => {
          e.stopPropagation(); this.toggleOption(value);
        });
        this.display.insertBefore(tag, arrow);
      });
    }
  }
  updateOptions() {
    this.options.forEach(option => {
      const checkbox = option.querySelector('.checkbox');
      const isSelected = this.selectedValues.has(option.dataset.value);
      if (isSelected) { option.classList.add('selected'); checkbox.classList.add('checked'); checkbox.innerHTML = '‚úì'; }
      else { option.classList.remove('selected'); checkbox.classList.remove('checked'); checkbox.innerHTML = ''; }
    });
  }
  filterOptions(q){
    const needle = (q||'').toLowerCase();
    this.options.forEach(opt=>{ const label = opt.textContent.toLowerCase(); opt.style.display = label.includes(needle) ? '' : 'none'; });
  }
  selectVisible(){
    this.options.forEach(opt=>{ if(opt.style.display !== 'none'){ this.selectedValues.add(opt.dataset.value); } });
    this.updateDisplay(); this.updateOptions(); this.onChangeCallback(this.getValues());
  }
  getValues() { return Array.from(this.selectedValues); }
  setValues(values) { this.selectedValues = new Set(values || []); this.updateDisplay(); this.updateOptions(); }
  clear() { this.selectedValues.clear(); this.updateDisplay(); this.updateOptions(); }
}

// === AUTO IMPORT FROM RANDOM ORDER CREATOR ===
function checkAndImportOrders() {
  console.log('üîç Checking for import data...');
  
  const importData = localStorage.getItem('garment_dpp_import_data');
  const importTimestamp = localStorage.getItem('garment_dpp_import_timestamp');
  
  console.log('Import data exists:', !!importData);
  console.log('Import timestamp:', importTimestamp);
  
  if (importData && importTimestamp) {
    try {
      const orders = JSON.parse(importData);
      const timestamp = parseInt(importTimestamp);
      const now = Date.now();
      const timeDiff = now - timestamp;
      
      console.log('üìä Import details:');
      console.log('- Orders count:', orders.length);
      console.log('- Time difference:', Math.round(timeDiff / 1000), 'seconds');
      console.log('- Within 10 minutes?', timeDiff < 10 * 60 * 1000);
      
      // Check if import is recent (within 10 minutes)
      if (timeDiff < 10 * 60 * 1000 && orders.length > 0) {
        console.log('‚úÖ Starting import process...');
        
        // Convert imported orders to Garment DPP format
        const convertedOrders = orders.map(order => {
          console.log('Converting order:', order.style || order.po);
          return {
            id: order.id || crypto.randomUUID(),
            country: order.country || 'T√ºrkiye',
            productionFacility: 'Rabateks Main Factory',
            po: order.po || `PO-${Math.floor(Math.random() * 90000) + 10000}`,
            style: order.style || 'IMPORTED-STYLE',
            productType: order.productType || 'Crew neck T-shirt',
            fabricType: mapFabricType(order.fabricType) || 'Circular Knit',
            fabricName: order.fabricName || 'Single Jersey',
            fabricCode: order.fabricCode || generateFabricCode(order.fabricType, order.fabricWeight),
            fabricConstruction: order.fabricConstruction || 'Single Jersey',
            fabricWeight: parseInt(order.fabricWeight) || 180,
            qty: parseInt(order.qty) || 1000,
            steps: Array.isArray(order.steps) ? order.steps : ['Cutting', 'Sewing', 'Quality Control', 'Packing'],
            co2: parseFloat(order.co2) || 0
          };
        });
        
        // Merge with existing orders (avoid duplicates)
        const existingOrders = state.rows || [];
        const existingKeys = new Set(existingOrders.map(r => `${r.po}|${r.style}`.toLowerCase()));
        
        const newOrders = convertedOrders.filter(order => {
          const key = `${order.po}|${order.style}`.toLowerCase();
          const isDuplicate = existingKeys.has(key);
          if (isDuplicate) {
            console.log('‚ö†Ô∏è Skipping duplicate:', order.po, order.style);
          }
          return !isDuplicate;
        });
        
        console.log('üî• New orders to import:', newOrders.length);
        
        if (newOrders.length > 0) {
          state.rows = [...newOrders, ...existingOrders];
          saveDB();
          render();
          
          // Show import notification
          showImportNotification(`Successfully imported ${newOrders.length} orders from Random Order Creator`);
          
          console.log(`‚úÖ Import completed: ${newOrders.length} orders added`);
        } else {
          console.log('‚ÑπÔ∏è No new orders to import (all duplicates)');
          showImportNotification(`No new orders to import - all orders already exist`);
        }
        
        // Clear import data to prevent re-import
        localStorage.removeItem('garment_dpp_import_data');
        localStorage.removeItem('garment_dpp_import_timestamp');
        console.log('üßπ Import data cleared');
        
      } else {
        console.log('‚ùå Import conditions not met:');
        if (timeDiff >= 10 * 60 * 1000) console.log('- Data too old (>10 minutes)');
        if (orders.length === 0) console.log('- No orders in import data');
      }
    } catch (error) {
      console.error('‚ùå Error importing orders:', error);
      showImportNotification(`Import failed: ${error.message}`);
    }
  } else {
    console.log('‚ÑπÔ∏è No import data found in localStorage');
  }
}

function mapFabricType(originalType) {
  // Map Random Order Creator fabric types to GarmentDPP options
  const typeMap = {
    'Knit': 'Circular Knit',
    'Circular Knit': 'Circular Knit',
    'Flatknit': 'Flatknit',
    'Woven': 'Woven',
    'Denim': 'Denim',
    'Nonwoven': 'Nonwoven'
  };
  return typeMap[originalType] || 'Circular Knit';
}

function showImportNotification(message) {
  const notification = document.getElementById('importNotification');
  const messageSpan = document.getElementById('importMessage');
  
  messageSpan.textContent = message;
  notification.classList.add('show');
  
  // Auto-hide after 5 seconds
  setTimeout(() => {
    notification.classList.remove('show');
  }, 5000);
}

// Manual import function
function manualImportOrders() {
  console.log('üîÑ Manual import triggered...');
  
  const importData = localStorage.getItem('garment_dpp_import_data');
  const importTimestamp = localStorage.getItem('garment_dpp_import_timestamp');
  
  if (!importData) {
    showImportNotification('No import data found. Please export orders from Random Order Creator first.');
    return;
  }
  
  try {
    const orders = JSON.parse(importData);
    console.log('üìä Found orders for import:', orders.length);
    
    if (orders.length === 0) {
      showImportNotification('No orders found in import data.');
      return;
    }
    
    // Convert imported orders to Garment DPP format
    const convertedOrders = orders.map(order => {
      console.log('Converting order:', order.style || order.po);
      return {
        id: order.id || crypto.randomUUID(),
        country: order.country || 'T√ºrkiye',
        productionFacility: 'Rabateks Main Factory',
        po: order.po || `PO-${Math.floor(Math.random() * 90000) + 10000}`,
        style: order.style || 'IMPORTED-STYLE',
        productType: order.productType || 'Crew neck T-shirt',
        fabricType: mapFabricType(order.fabricType) || 'Circular Knit',
        fabricName: order.fabricName || 'Single Jersey',
        fabricCode: order.fabricCode || generateFabricCode(order.fabricType, order.fabricWeight),
        fabricConstruction: order.fabricConstruction || 'Single Jersey',
        fabricWeight: parseInt(order.fabricWeight) || 180,
        qty: parseInt(order.qty) || 1000,
        steps: Array.isArray(order.steps) ? order.steps : ['Cutting', 'Sewing', 'Quality Control', 'Packing'],
        co2: parseFloat(order.co2) || 0
      };
    });
    
    // Merge with existing orders (avoid duplicates)
    const existingOrders = state.rows || [];
    const existingKeys = new Set(existingOrders.map(r => `${r.po}|${r.style}`.toLowerCase()));
    
    const newOrders = convertedOrders.filter(order => {
      const key = `${order.po}|${order.style}`.toLowerCase();
      const isDuplicate = existingKeys.has(key);
      if (isDuplicate) {
        console.log('‚ö†Ô∏è Skipping duplicate:', order.po, order.style);
      }
      return !isDuplicate;
    });
    
    console.log('üî• New orders to import:', newOrders.length);
    
    if (newOrders.length > 0) {
      state.rows = [...newOrders, ...existingOrders];
      saveDB();
      render();
      
      showImportNotification(`Successfully imported ${newOrders.length} orders from Random Order Creator`);
      console.log(`‚úÖ Manual import completed: ${newOrders.length} orders added`);
      
      // Clear import data after successful import
      localStorage.removeItem('garment_dpp_import_data');
      localStorage.removeItem('garment_dpp_import_timestamp');
    } else {
      showImportNotification(`No new orders to import - all ${orders.length} orders already exist`);
    }
    
  } catch (error) {
    console.error('‚ùå Error during manual import:', error);
    showImportNotification(`Import failed: ${error.message}`);
  }
}

function generateFabricCode(fabricType, weight) {
  const prefixes = { 
    'Cotton': 'CT', 'Knit': 'KN', 'Woven': 'WV', 'Denim': 'DN', 
    'Polyester': 'PL', 'Wool': 'WL', 'Linen': 'LN', 'Silk': 'SK', 
    'Spandex': 'SP', 'Rayon': 'RY' 
  };
  const prefix = prefixes[fabricType] || 'XX';
  const suffix = Math.random().toString(36).substr(2, 2).toUpperCase();
  return `${suffix}-${weight || 180}-${prefix}`;
}

// === CORE FUNCTIONS ===
function addRecord() {
  const country = document.getElementById('country').value;
  const productionFacility = document.getElementById('productionFacility').value;
  const po = document.getElementById('po').value.trim();
  const style = document.getElementById('style').value.trim();
  const productType = document.getElementById('productType').value;
  const fabricType = document.getElementById('fabricType').value;
  const fabricName = document.getElementById('fabricName').value.trim();
  const fabricCode = document.getElementById('fabricCode').value.trim();
  const fabricConstruction = document.getElementById('fabricConstruction').value;
  const fabricWeight = parseInt(document.getElementById('fabricWeight').value) || 0;
  const qty = parseInt(document.getElementById('qty').value) || 0;
  const steps = stepsMS.getValues();
  const co2 = parseFloat(document.getElementById('co2').value) || 0;

  if (!po || !style || !fabricName || !fabricCode) {
    alert('Please fill required fields: PO No., Style Name, Fabric Name, Fabric Code');
    return;
  }

  const newRecord = {
    id: crypto.randomUUID(),
    country, productionFacility, po, style, productType, fabricType,
    fabricName, fabricCode, fabricConstruction, fabricWeight, qty, steps, co2
  };

  state.rows.unshift(newRecord);
  saveDB();
  clearForm();
  render();
}

function clearForm() {
  document.getElementById('country').value = 'T√ºrkiye';
  document.getElementById('productionFacility').value = 'Rabateks Main Factory';
  document.getElementById('po').value = '';
  document.getElementById('style').value = '';
  document.getElementById('productType').value = 'Crew neck T-shirt';
  document.getElementById('fabricType').value = 'Woven';
  document.getElementById('fabricName').value = '';
  document.getElementById('fabricCode').value = '';
  document.getElementById('fabricConstruction').value = 'Single Jersey';
  document.getElementById('fabricWeight').value = '';
  document.getElementById('qty').value = '';
  document.getElementById('co2').value = '';
  stepsMS.clear();
}

function editRecord(id) {
  const record = state.rows.find(r => r.id === id);
  if (!record) return;

  state.editing = id;
  document.getElementById('formWrap').classList.add('editing');
  document.getElementById('addBtn').style.display = 'none';
  document.getElementById('saveChangesBtn').style.display = 'inline-block';
  document.getElementById('cancelEditBtn').style.display = 'inline-block';

  document.getElementById('country').value = record.country;
  document.getElementById('productionFacility').value = record.productionFacility;
  document.getElementById('po').value = record.po;
  document.getElementById('style').value = record.style;
  document.getElementById('productType').value = record.productType;
  document.getElementById('fabricType').value = record.fabricType;
  document.getElementById('fabricName').value = record.fabricName;
  document.getElementById('fabricCode').value = record.fabricCode;
  document.getElementById('fabricConstruction').value = record.fabricConstruction;
  document.getElementById('fabricWeight').value = record.fabricWeight;
  document.getElementById('qty').value = record.qty;
  document.getElementById('co2').value = record.co2;
  stepsMS.setValues(record.steps || []);
}

function saveChanges() {
  const record = state.rows.find(r => r.id === state.editing);
  if (!record) return;

  record.country = document.getElementById('country').value;
  record.productionFacility = document.getElementById('productionFacility').value;
  record.po = document.getElementById('po').value.trim();
  record.style = document.getElementById('style').value.trim();
  record.productType = document.getElementById('productType').value;
  record.fabricType = document.getElementById('fabricType').value;
  record.fabricName = document.getElementById('fabricName').value.trim();
  record.fabricCode = document.getElementById('fabricCode').value.trim();
  record.fabricConstruction = document.getElementById('fabricConstruction').value;
  record.fabricWeight = parseInt(document.getElementById('fabricWeight').value) || 0;
  record.qty = parseInt(document.getElementById('qty').value) || 0;
  record.steps = stepsMS.getValues();
  record.co2 = parseFloat(document.getElementById('co2').value) || 0;

  if (!record.po || !record.style || !record.fabricName || !record.fabricCode) {
    alert('Please fill required fields: PO No., Style Name, Fabric Name, Fabric Code');
    return;
  }

  saveDB();
  cancelEdit();
  render();
}

function cancelEdit() {
  state.editing = null;
  document.getElementById('formWrap').classList.remove('editing');
  document.getElementById('addBtn').style.display = 'inline-block';
  document.getElementById('saveChangesBtn').style.display = 'none';
  document.getElementById('cancelEditBtn').style.display = 'none';
  clearForm();
}

function deleteRecord(id) {
  if (!confirm('Are you sure you want to delete this record?')) return;
  state.rows = state.rows.filter(r => r.id !== id);
  saveDB();
  render();
}

function calculateCO2() {
  const fabricWeight = parseInt(document.getElementById('fabricWeight').value) || 0;
  const qty = parseInt(document.getElementById('qty').value) || 0;
  const productType = document.getElementById('productType').value;

  // Simplified CO2 calculation
  // Estimate: fabric weight (gsm) √ó product area (m¬≤) √ó emission factor (kg CO2/kg fabric) √ó quantity
  const productAreas = {
    'Crew neck T-shirt': 0.8, 'V-neck T-shirt': 0.8, 'Polo shirt': 0.9,
    'Dress shirt': 1.2, 'Casual shirt': 1.1, 'Hoodie': 1.4,
    'Trousers': 1.6, 'Jeans': 1.8, 'Dress': 2.2, 'Jacket': 2.8
  };
  
  const area = productAreas[productType] || 1.0; // Default 1 m¬≤
  const emissionFactor = 0.0025; // kg CO2 per kg fabric (simplified)
  
  const co2 = (fabricWeight / 1000) * area * emissionFactor * qty;
  document.getElementById('co2').value = co2.toFixed(2);
}

function generateCode() {
  const fabricType = document.getElementById('fabricType').value;
  const fabricName = document.getElementById('fabricName').value;
  const fabricWeight = document.getElementById('fabricWeight').value || '180';
  
  const typeMap = {
    'Woven': 'WV', 'Denim': 'DN', 'Circular Knit': 'KN',
    'Flatknit': 'FK', 'Nonwoven': 'NW'
  };
  
  const nameMap = {
    'Single Jersey': 'SJ', 'Double Jersey': 'DJ', 'Interlock': 'IL',
    'Plain Weave': 'PW', 'Twill': 'TW', 'Denim': 'DN',
    'Oxford': 'OX', 'Poplin': 'PL', 'Canvas': 'CV'
  };
  
  const typeCode = typeMap[fabricType] || 'XX';
  const nameCode = nameMap[fabricName] || fabricName.substring(0,2).toUpperCase();
  
  const fabricCode = `${nameCode}-${fabricWeight}-${typeCode}`;
  document.getElementById('fabricCode').value = fabricCode;
}

function render() {
  renderMetrics();
  renderList();
}

function renderMetrics() {
  const rows = state.rows;
  const totalPos = new Set(rows.map(r => r.po)).size;
  const totalQty = rows.reduce((sum, r) => sum + r.qty, 0);
  const avgGsm = rows.length ? Math.round(rows.reduce((sum, r) => sum + r.fabricWeight, 0) / rows.length) : 0;
  const uniqueStyles = new Set(rows.map(r => r.style)).size;
  const totalCO2 = rows.reduce((sum, r) => sum + r.co2, 0);

  document.getElementById('mPos').textContent = totalPos.toLocaleString();
  document.getElementById('mQty').textContent = totalQty.toLocaleString();
  document.getElementById('mAvgGsm').textContent = avgGsm;
  document.getElementById('mStyles').textContent = uniqueStyles;
  document.getElementById('mCO2').textContent = totalCO2.toFixed(1);
}

function renderList() {
  const container = document.getElementById('scorecards');
  if (!state.rows.length) {
    container.innerHTML = '<div style="text-align:center;padding:40px;color:var(--muted)">No records yet. Add your first garment record above!</div>';
    return;
  }

  container.innerHTML = state.rows.map(row => `
    <div class="scorecard">
      <div class="scorecard-header">
        <span>üè∑Ô∏è ${row.po} ‚Ä¢ ${row.style}</span>
        <div class="row-actions">
          <button class="icon-btn edit" onclick="editRecord('${row.id}')">‚úèÔ∏è Edit</button>
          <button class="icon-btn delete" onclick="deleteRecord('${row.id}')">üóëÔ∏è Delete</button>
        </div>
      </div>
      <div class="scorecard-body">
        <div class="grid">
          <div class="kv"><div class="k">Country</div><div class="v">${row.country}</div></div>
          <div class="kv"><div class="k">Production Facility</div><div class="v">${row.productionFacility}</div></div>
          <div class="kv"><div class="k">Product Type</div><div class="v">${row.productType}</div></div>
          <div class="kv"><div class="k">Fabric Type</div><div class="v">${row.fabricType}</div></div>
          <div class="kv"><div class="k">Fabric Name</div><div class="v">${row.fabricName}</div></div>
          <div class="kv"><div class="k">Fabric Code</div><div class="v">${row.fabricCode}</div></div>
          <div class="kv"><div class="k">Construction</div><div class="v">${row.fabricConstruction}</div></div>
          <div class="kv"><div class="k">Weight (gsm)</div><div class="v">${row.fabricWeight}</div></div>
          <div class="kv"><div class="k">Quantity</div><div class="v">${row.qty.toLocaleString()}</div></div>
          <div class="kv"><div class="k">Production Steps</div><div class="v">${(row.steps || []).join(', ') || 'None'}</div></div>
          <div class="kv"><div class="k">CO‚ÇÇ Emission</div><div class="v">${row.co2} kg</div></div>
        </div>
      </div>
    </div>
  `).join('');
}

function exportCsv() {
  if (!state.rows.length) {
    alert('No data to export');
    return;
  }

  const headers = ['Country', 'Production Facility', 'PO No', 'Style Name', 'Product Type', 'Fabric Type', 'Fabric Name', 'Fabric Code', 'Fabric Construction', 'Fabric Weight (gsm)', 'Quantity', 'Production Steps', 'CO2 Emission (kg)'];
  
  const csvContent = [
    headers.join(','),
    ...state.rows.map(row => [
      row.country, row.productionFacility, row.po, row.style, row.productType,
      row.fabricType, row.fabricName, row.fabricCode, row.fabricConstruction,
      row.fabricWeight, row.qty, (row.steps || []).join(';'), row.co2
    ].map(field => `"${field}"`).join(','))
  ].join('\n');

  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `garment-dpp-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

function importCsv() {
  const input = document.createElement('input');
  input.type = 'file';
  input.accept = '.csv';
  input.onchange = (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = (e) => {
      try {
        const csv = e.target.result;
        const lines = csv.split('\n').filter(line => line.trim());
        const headers = lines[0].split(',').map(h => h.replace(/"/g, ''));
        
        const importedRows = lines.slice(1).map(line => {
          const values = line.split(',').map(v => v.replace(/"/g, ''));
          const steps = values[11] ? values[11].split(';') : [];
          
          return {
            id: crypto.randomUUID(),
            country: values[0] || 'T√ºrkiye',
            productionFacility: values[1] || 'Rabateks Main Factory',
            po: values[2] || '',
            style: values[3] || '',
            productType: values[4] || 'Crew neck T-shirt',
            fabricType: values[5] || 'Circular Knit',
            fabricName: values[6] || '',
            fabricCode: values[7] || '',
            fabricConstruction: values[8] || 'Single Jersey',
            fabricWeight: parseInt(values[9]) || 0,
            qty: parseInt(values[10]) || 0,
            steps: steps,
            co2: parseFloat(values[12]) || 0
          };
        });

        state.rows = [...importedRows, ...state.rows];
        saveDB();
        render();
        alert(`Imported ${importedRows.length} records`);
      } catch (error) {
        alert('Error importing CSV: ' + error.message);
      }
    };
    reader.readAsText(file);
  };
  input.click();
}

function downloadTemplate() {
  const headers = ['Country', 'Production Facility', 'PO No', 'Style Name', 'Product Type', 'Fabric Type', 'Fabric Name', 'Fabric Code', 'Fabric Construction', 'Fabric Weight (gsm)', 'Quantity', 'Production Steps', 'CO2 Emission (kg)'];
  const sampleRow = ['T√ºrkiye', 'Rabateks Main Factory', 'PO-12345', 'SAMPLE-TSH', 'Crew neck T-shirt', 'Circular Knit', 'Single Jersey', 'SJ-180-KN', 'Single Jersey', '180', '1000', 'Cutting;Sewing;Quality Control;Packing', '3.6'];
  
  const csvContent = [
    headers.join(','),
    sampleRow.map(field => `"${field}"`).join(',')
  ].join('\n');

  const blob = new Blob([csvContent], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'garment-dpp-template.csv';
  a.click();
  URL.revokeObjectURL(url);
}

function debugImport() {
  const importData = localStorage.getItem('garment_dpp_import_data');
  const importTimestamp = localStorage.getItem('garment_dpp_import_timestamp');
  
  console.log('=== DEBUG IMPORT ===');
  console.log('Import data exists:', !!importData);
  console.log('Import timestamp:', importTimestamp);
  
  if (importData) {
    try {
      const orders = JSON.parse(importData);
      console.log('Orders count:', orders.length);
      console.log('First order:', orders[0]);
      alert(`Found ${orders.length} orders in import data. Check console for details.`);
    } catch (error) {
      console.error('Error parsing import data:', error);
      alert('Error parsing import data: ' + error.message);
    }
  } else {
    alert('No import data found in localStorage');
  }
}

// === MAIN APP STATE & INIT ===
let state = { rows: [], editing: null };

function loadDB() {
  const saved = localStorage.getItem('garmentDPP');
  if (saved) state = JSON.parse(saved);
}

function saveDB() {
  localStorage.setItem('garmentDPP', JSON.stringify(state));
}

// Initialize multi-select
let stepsMS;

// Event listeners
document.addEventListener('DOMContentLoaded', () => {
  loadDB();
  
  // Check for auto-import on page load
  checkAndImportOrders();
  
  stepsMS = new MultiSelect(document.getElementById('stepsMultiSelect'), {
    placeholder: 'Select production steps...',
    onChange: (values) => console.log('Steps selected:', values)
  });

  document.getElementById('addBtn').onclick = addRecord;
  document.getElementById('clearBtn').onclick = clearForm;
  document.getElementById('saveChangesBtn').onclick = saveChanges;
  document.getElementById('cancelEditBtn').onclick = cancelEdit;
  document.getElementById('exportCsvBtn').onclick = exportCsv;
  document.getElementById('importCsvBtn').onclick = importCsv;
  document.getElementById('templateCsvBtn').onclick = downloadTemplate;
  document.getElementById('debugImportBtn').onclick = debugImport;
  document.getElementById('importOrdersBtn').onclick = manualImportOrders; // NEW
  document.getElementById('genCodeBtn').onclick = generateCode;

  // Auto-calculate CO2 when relevant fields change
  document.getElementById('fabricWeight').oninput = calculateCO2;
  document.getElementById('qty').oninput = calculateCO2;
  document.getElementById('productType').onchange = calculateCO2;

  render();
});
</script>
</body>
</html>